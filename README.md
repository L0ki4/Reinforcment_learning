# Виртуальная АЗС Gym-GPN

## Общее описание

Среда моделирует зависимость спроса на топливо от цены и базируется на фреймворке OpenAI Gym. Агент совершает действие в среде – устанавливает цену в рамках ценового коридора от 30 до 55 рублей (цены за рамками коридора округляются до ближайшей границы коридора). Среда отвечает на действия агента кортежем значений:

- Наблюдение агента по итогам совершенного действия;
- Сумма вознаграждения, полученного после совершенного действия;
- Флаг окончания периода.

Задача агента – максимизировать суммарное вознаграждение за период. Обучение будет производиться на периоде в 12 недель, начиная с 2018-06-01T00:00:00. Итоговое тестирование – на следующих четырех неделях, начиная с 2018-08-24T00:00:00. Основные особенности спроса (такие как, недельная и дневная сезонность) на тренировочном периоде соответствуют таковым на тренировочном периоде, однако не совпадают полностью. Поэтому поощряется применение методов meta learning – дообучение в процессе тестирования.

## Описание файлов
```
├── Dockerfile                  <- Файл для сборки docker-образа
├── README.md                   <- Этот readme-файл
├── examples                    <- Папка с примерами
│   └── agents                  <- Примеры агентов
│       └── random_walk.py      <- Агент со случайным выбором цены
├── gym_gpn                     <- Модуль сред Gym-GPN
│   ├── __init__.py             <- Делает `gym_gpn` модулем Python
│   └── envs                    <- Папка со средами
│       ├── __init__.py         <- Делает `envs` модулем Python
│       └── gpn_env.py          <- Среда Gym-GPN
├── gym_gpn_example.ipynb       <- Jupyter notebook с примерами использования среды
└── setup.py                    <- Файл установки модуля
```

## Предварительные требования

Необходимы следующие базовые компоненты:

- git
- python3
- jupyter
- docker
- AWS CLI

## Установка среды

```bash
git clone https://bitbucket.org/kiselev_gpn/gym-gpn.git
cd gym-gpn
pip install -e .
```

## Необходимые учетные данные

Для участия в конкурсе необходимо наличие следующих учетных данных, которые предоставляются представителями компании Газпром нефть:

- `<team_name>` – краткое имя команды, используемое для наименования итогового docker-образа;
- `<token>` – уникальный ключ, который необходимо использовать в `gym_gpn_example.ipynb`, `examples/agents/random_walk.py`, а также в коде разработанного агента для создания инстансов виртуальной АЗС;
- `<url>` – адрес для загрузки финального docker-образа.

## Сборка результата

Результат предоставляется в виде готового docker-образа, содержащего все необходимые зависимости и выводящего логи (метка времени, накопленное вознаграждение) в командную строку. Пример docker-файла для сборки docker-образа – `Dockerfile`. Порядок сборки:

1. Указать в `Dockerfile` корректные ссылки на базовый образ (в примере `python:3.6-jessie`), пути к исходным файлам, рабочую директорию;
2. По необходимости добавить зависимости в `setup.py`;
3. Указать актуальный путь для запуска разработанного агента;
4. Собрать образ из папки с `Dockerfile`, используя имя команды `<team_name>` в качестве названия образа `<image_name>`: `docker build -t <image_name>`
5. Проверить работу образа: `docker run —rm <image_name>`
6. По необходимости скорректировать образ при помощи команд:
    - Остановка запущенного контейнера: `docker stop <image_name>`;
    - Удаление созданного образа: `docker rmi <image_name>`;
    - Подключение к запущенному docker-контейнеру: `docker exec -it <image_name> /bin/bash`;
    - Сохранение внесенных изменений в запущенном docker-контейнере: `docker commit <container name> <image name>`.
7. Готовый docker-образ сохранить в виде .tar файла в отдельную папку: `docker save <image name> > docker/<team_name>.tar`
8. Загрузить .tar файл на `<url>` до 00-00 01.11.2018: `aws s3 cp ./docker/ <url> --recursive`. Результаты, загруженные позже указанного времени рассматриваться не будут.
